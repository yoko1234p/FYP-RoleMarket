services:
  fyp-rolemarket:
    build: .
    container_name: fyp-rolemarket
    ports:
      - "8501:8501"  # Streamlit web interface
    volumes:
      # Mount source code for development (hot reload)
      - ./obj1_nlp_prompt:/app/obj1_nlp_prompt
      - ./obj2_midjourney_api:/app/obj2_midjourney_api
      - ./obj3_lstm_forecast:/app/obj3_lstm_forecast
      - ./obj4_web_app:/app/obj4_web_app
      # Mount data directories (persistent storage)
      - ./data:/app/data
      - ./config:/app/config
    env_file:
      - .env
    environment:
      - PYTHONUNBUFFERED=1
      - STREAMLIT_SERVER_PORT=8501
      - STREAMLIT_SERVER_ADDRESS=0.0.0.0
    restart: unless-stopped
    # Health check for Streamlit
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8501/_stcore/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s

# Optional: Jupyter notebook service for development
  jupyter:
    build: .
    container_name: fyp-jupyter
    command: jupyter notebook --ip=0.0.0.0 --port=8888 --no-browser --allow-root
    ports:
      - "8888:8888"
    volumes:
      - ./obj1_nlp_prompt:/app/obj1_nlp_prompt
      - ./obj2_midjourney_api:/app/obj2_midjourney_api
      - ./obj3_lstm_forecast:/app/obj3_lstm_forecast
      - ./data:/app/data
      - ./docs:/app/docs
    env_file:
      - .env
    environment:
      - JUPYTER_ENABLE_LAB=yes
    profiles:
      - dev  # Only start with: docker-compose --profile dev up
